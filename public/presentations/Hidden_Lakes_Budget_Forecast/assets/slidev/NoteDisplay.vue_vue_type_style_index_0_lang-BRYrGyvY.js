import{d as M,y as H,t as N,D as B,n as T,_ as $,b as f,i as p,e as S,x as w,o as k}from"../modules/vue-DUIs0fbu.js";import{C as A}from"../index-DRVGoXVi.js";const I=["innerHTML"],P=["textContent"],q=["textContent"],d="slidev-note-fade",c="slidev-note-click-mark",V=M({__name:"NoteDisplay",props:{class:{},noteHtml:{},note:{},placeholder:{},clicksContext:{},autoScroll:{type:Boolean}},emits:["markerDblclick","markerClick"],setup(E,{emit:b}){const l=E,v=b,h=H(()=>{var s,n;return((s=l.clicksContext)==null?void 0:s.current)!=null&&((n=l.noteHtml)==null?void 0:n.includes("slidev-note-click-mark"))}),a=N(null);function C(){var L;if(!a.value||!h.value)return;const s=Array.from(a.value.querySelectorAll(`.${c}`)),n=+(((L=l.clicksContext)==null?void 0:L.current)??A),r=n<0||n>=A,g=new Set;function y(e){!e||e===a.value||(g.add(e),e.parentElement&&y(e.parentElement))}const _=new Map;for(const e of s){const t=e.parentElement,o=Number(e.dataset.clicks);_.set(o,e),y(t),Array.from(t.childNodes).forEach(u=>{if(u.nodeType===3){const x=document.createElement("span");x.textContent=u.textContent,t.insertBefore(x,u),u.remove()}})}const D=Array.from(a.value.querySelectorAll("*"));let i=0;const m=new Map;for(const e of D)m.has(i)||m.set(i,[]),m.get(i).push(e),e.classList.contains(c)&&(i=Number(e.dataset.clicks)||i+1);for(const[e,t]of m)r?t.forEach(o=>o.classList.remove(d)):t.forEach(o=>o.classList.toggle(d,g.has(o)?!1:e!==n));for(const[e,t]of _)t.classList.remove(d),t.classList.toggle(`${c}-past`,r?!1:e<n),t.classList.toggle(`${c}-active`,r?!1:e===n),t.classList.toggle(`${c}-next`,r?!1:e===n+1),t.classList.toggle(`${c}-future`,r?!1:e>n+1),t.ondblclick=o=>{v("markerDblclick",o,e),!o.defaultPrevented&&(l.clicksContext.current=e,o.stopPropagation(),o.stopImmediatePropagation())},t.onclick=o=>{v("markerClick",o,e)},l.autoScroll&&e===n&&t.scrollIntoView({block:"center",behavior:"smooth"})}return B(()=>{var s;return[l.noteHtml,(s=l.clicksContext)==null?void 0:s.current]},()=>{T(()=>{C()})},{immediate:!0}),$(()=>{C()}),(s,n)=>s.noteHtml?(k(),f("div",{key:0,ref_key:"noteDisplay",ref:a,class:p(["prose overflow-auto outline-none slidev-note",[l.class,h.value?"slidev-note-with-clicks":""]]),innerHTML:s.noteHtml},null,10,I)):s.note?(k(),f("div",{key:1,class:p(["prose overflow-auto outline-none slidev-note",l.class])},[S("p",{textContent:w(s.note)},null,8,P)],2)):(k(),f("div",{key:2,class:p(["prose overflow-auto outline-none opacity-50 italic select-none slidev-note",l.class])},[S("p",{textContent:w(l.placeholder||"No notes.")},null,8,q)],2))}});export{V as _};
