---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PresentationCard from '../../components/PresentationCard.astro';
import { getCollection } from 'astro:content';

const allPresentations = await getCollection('presentations');
const categories = [...new Set(allPresentations.map(pres => pres.data.category))];
const selectedCategory = Astro.url.searchParams.get('category') || 'all';

const filteredPresentations = selectedCategory === 'all'
  ? allPresentations
  : allPresentations.filter(pres => pres.data.category === selectedCategory);

const sortedPresentations = filteredPresentations.sort((a, b) => 
  b.data.date.getTime() - a.data.date.getTime()
);
---

<BaseLayout 
  title="Market Analysis Presentations"
  description="Energy market analysis presentations and insights">
  
  <div class="container mx-auto px-4 py-12">
    <h1 class="text-4xl font-bold mb-8">Market Analysis Presentations</h1>
    
    <div class="flex flex-wrap gap-4 mb-8">
      <a 
        href="/presentations"
        class={`px-4 py-2 rounded-full text-sm font-medium ${
          selectedCategory === 'all' 
            ? 'bg-brand-primary text-brand-secondary' 
            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
        }`}
      >
        All Categories
      </a>
      {categories.map(category => (
        <a 
          href={`/presentations?category=${category}`}
          class={`px-4 py-2 rounded-full text-sm font-medium ${
            selectedCategory === category 
              ? 'bg-brand-primary text-brand-secondary' 
              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
          }`}
        >
          {category}
        </a>
      ))}
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {sortedPresentations.map(presentation => (
        <PresentationCard presentation={presentation} />
      ))}
    </div>
  </div>
</BaseLayout>